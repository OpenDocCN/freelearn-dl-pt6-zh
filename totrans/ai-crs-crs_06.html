<html><head></head><body>
		<div id="_idContainer172">
			<h1 class="chapterNumber sigil_not_in_toc">6</h1>
			<h1 class="chapterTitle" xml:lang="en-GB" id="sigil_toc_id_77" lang="en-GB"><a id="_idTextAnchor113"/>AI for Sales and Advertising – Sell like the Wolf of AI Street</h1>
</div>

			<p class="normal">Now it's time to put your new skills into practice,
 start coding, and shape up your AI skills! You've learned all about 
Thompson Sampling, and now it's time to implement this AI model to solve
 a real-world problem, maximizing the sales of an e-commerce business.</p>
			<p class="normal">In this practical exercise, you'll really take 
action and build the AI yourself to solve the problem. It's really 
important that you stay active in this chapter, because this is where 
you will have the chance to learn by doing, which is the most effective 
way to learn something; practice truly makes perfect. In other words, I 
want you to be the hero of this AI adventure. You, and not me. Ready?</p>
			<h2 class="title" xml:lang="en-GB" id="sigil_toc_id_78" lang="en-GB"><a id="_idTextAnchor114"/>Problem to solve</h2>
			<p class="normal">Imagine an e-commerce business that has millions of
 customers. These customers are people buying products on the website 
from time to time, getting those products delivered to their homes. The 
business is doing well, but the board of executives has decided to 
follow an action plan to maximize revenue.</p>
			<p class="normal">This plan consists of offering the customers the 
option to subscribe to a premium plan, which will give them benefits 
like reduced prices, special deals, and so on. This premium plan is 
offered at a yearly price of $200, and the goal of this e-commerce 
business is, of course, to get the maximum number of customers to 
subscribe to this premium plan. Let's do some quick math to give us some
 motivation for building an AI to maximize the revenue of this business.</p>
			<p class="normal">Let's say that this e-commerce business <a id="_idIndexMarker138"/>has
 100 million customers. Now consider two strategies to convert the 
customers to the premium plan: a bad one, with a conversion rate of 1%, 
and a good one, with a conversion rate of 11%. If the business deploys 
the bad strategy, in one year it will make a total of: 100,000,000 × 
0.01 × 200 = $200,000,000 in extra revenue from the premium plan 
subscriptions.</p>
			<p class="normal">On the other hand, if the business deploys the good
 strategy, in one year it will make a total of: 100,000,000 × 0.11 × 200
 = $2,200,000,000 in extra revenue from the premium plan subscriptions. 
By figuring out<a id="_idIndexMarker139"/> the best strategy to deploy, the business maximizes its revenue by making 2 billion extra dollars.</p>
			<p class="normal">In this Utopian example, we only had two 
strategies, and besides, we knew their conversion rates. In our case 
study, we will be facing nine different strategies. Our AI will have no 
idea of which is the best one, and absolutely no prior information on 
any of their conversion rates.</p>
			<p class="normal">We will, however, make the assumption that each of 
these nine strategies does have a fixed conversion rate. These 
strategies were carefully and smartly elaborated by the marketing team, 
and each of them has the same goal: convert the maximum number of 
clients to the premium plan. However, these nine strategies are all 
different. They have different forms, different packages, different ads,
 and different special deals to convince and persuade the clients to 
subscribe to the premium plan. Of course, the marketing team has no idea
 of which of these nine strategies will turn out to be the best one. 
Let's sum up the differences in features of these nine strategies:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_01.png" alt=""/></figure>
			<p class="packt_figref">Figure 1: The nine strategies – Which one sells best?</p>
			<p class="normal">The marketing team wants to figure out which 
strategy has the highest conversion rate as soon as possible, and by 
spending the minimum amount. They know that finding and deploying the 
best strategy can significantly increase the business's revenue. The 
marketing experts have also chosen not to send an email directly to 
their 100 million customers, because that would be costly and would risk
 spamming too many customers. Instead, they will subtly look for that 
best strategy through online learning. What is online learning? It 
consists of deploying a different strategy each time a customer browses 
the e-commerce website.</p>
			<p class="normal">As the customer navigates the website, they will suddenly get a pop-up ad, suggesting to them that they subscribe to the<a id="_idIndexMarker140"/>
 premium plan. For each customer browsing the website, only one of the 
nine strategies will be displayed. Then the user will choose, or not, to
 take action and subscribe to the premium plan. If the customer 
subscribes, the strategy is a success; otherwise, it is a failure. The 
more customers we do this with, the more feedback we collect, and the 
better idea we get of what the best strategy is.</p>
			<p class="normal">But of course, we will not figure this out 
manually, visually, or with some simple math. Instead we want to 
implement the smartest algorithm that will figure out what the best 
strategy is in the shortest time. That's for the same two reasons: 
firstly, because deploying each strategy has a cost (for example, coming
 from the pop-up ad); and secondly, because the company wants to <a id="_idIndexMarker141"/>annoy the fewest customers with their a<a id="_idTextAnchor115"/>d.</p>
			<h2 class="title" xml:lang="en-GB" id="sigil_toc_id_79" lang="en-GB"><a id="_idTextAnchor116"/>Building the environment inside a simulation</h2>
			<p class="normal">This section is quite special, because<a id="_idIndexMarker142"/>
 there's something crucial to understand which is not obvious at first 
sight. The reason for this warning is my experience in teaching this 
subject; many of my students had issues understanding why we have to do a
 simulation here, for this whole problem.</p>
			<p class="normal">It was the same for me when I started! If you 
already understand why we have to make a simulation, that's great—it 
means you already have online learning under your skin. If not, follow 
me here and let me explain carefully.</p>
			<p class="normal">To understand, let's start by explaining what would
 happen in real life: you would simply display the "call to action" 
pop-up ad of one of the nine strategies to customers who are navigating 
the website, and you'd do this one customer at a time. You'd have to do 
it one customer at a time, customer after customer, because for each 
customer you need to collect their response: whether or not the customer
 subscribes to the premium plan. If the customer does, the reward is 1. 
If not, the reward is 0. It would go like this:</p>
			<p class="normal"><strong class="bold">Round 1</strong>: We display <em class="italics">Ad 1</em> of <em class="italics">Strategy 1</em> to a customer, <em class="italics">Customer 1</em>,
 and we check to see if the customer chooses to subscribe. If yes, we 
get a 1 reward, if no, we get a 0 reward. After collecting our reward, 
we move on to the next customer (next round).</p>
			<p class="normal"><strong class="bold">Round 2</strong>: We display <em class="italics">Ad 2</em> of <em class="italics">Strategy 2</em> to a new customer, <em class="italics">Customer 2</em>,
 and we check to see if the customer chooses to subscribe. If yes, we 
get a 1 reward, if no, we get a 0 reward. After collecting our reward, 
we move on to the next customer (next round).</p>
			<p class="normal">… </p>
			<p class="normal"><strong class="bold">Round 9</strong>: We display <em class="italics">Ad 9</em> of <em class="italics">Strategy 9</em> to a new customer, <em class="italics">Customer 9</em>,
 and we check to see if the customer chooses to subscribe. If yes, we 
get a 1 reward, if no, we get a 0 reward. After collecting our reward, 
we move on to the next customer (next round).</p>
			<p class="normal"><strong class="bold">Round 10</strong>: We finally 
start activating Thompson Sampling! We use the Thompson Sampling AI to 
tell us which ad has the strongest magic touch to convert the maximum 
customers to subscribe to the premium plan. We want that extra revenue! 
The AI (powered by Thompson Sampling) selects one of the 9 ads to 
display to a new customer, <em class="italics">Customer 10</em>, and 
then checks to see if the customer chooses to subscribe. If yes, we get a
 1 reward, if no, we get a 0 reward. After collecting our reward, we 
move on to the next customer (next round).</p>
			<p class="normal"><strong class="bold">Round 11</strong>: The AI (powered by Thompson Sampling) selects one of the 9 ads to display to a new customer, say <em class="italics">Customer 11</em>, and then checks to see if the customer chooses to subscribe. If yes, we get a 1 reward, if no, we<a id="_idIndexMarker143"/> get a 0 reward. After collecting our reward, we move on to the next customer (next round).</p>
			<p class="normal">OK, I'll stop! You get the idea. That continues on 
and on for hundreds of rounds, or at least until the AI has found the 
best ad—the one with the highest conversion rate.</p>
			<p class="normal">This is what would happen in real life. We don't 
need anything else at each round; if you look at the Thompson Sampling 
algorithm, at each round it only needs the number of times each ad has 
received a 1 reward in the previous rounds, and the number of times each
 ad has received a 0 reward in the previous rounds. In conclusion, and 
this is a very important conclusion: Thompson Sampling absolutely does 
not need to know the conversion rates of the ads in order to figure out 
the best ad.</p>
			<p class="normal">However, in order to simulate this application, we 
will need to attribute a conversion rate to each of these ads. That's 
for the simple reason that if we don't do this, we will never be able to
 verify that Thompson Sampling indeed found the best ad. This is just to
 check that the AI works!</p>
			<p class="normal">What we will do is attribute a different conversion
 rate to each of the nine strategies. The purpose of this simulation 
will only be to check that the AI manages to catch the best ad, with the
 highest conversion rate. Let me rephrase this as two essential points:</p>
			<ol>
				<li class="list" value="1">Thompson Sampling at no time needs to know the conversion rates in order to figure out the highest one.</li>
				<li class="list">The only reason we know the conversion rates in 
advance is because we are doing a simulation, just to check that 
Thompson Sampling actually manages to figure out the ad that has the 
highest conversion rate.</li>
			</ol>
			<p class="normal">Now we've got that covered, let's finally set these
 conversion rates. We will assume the nine strategies have the following
 conversion rates:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_02.png" alt=""/></figure>
			<p class="packt_figref">Figure 2: Conversion rates of the 9 strategies</p>
			<p class="normal">Now, we behind the scenes know in advance which strategy has the highest conversion rate: Strategy number <strong class="bold">7</strong>. However, Thompson <a id="_idIndexMarker144"/>Sampling
 doesn't know it. If you pay attention, you can see the fact that at no 
time does Thompson Sampling use the conversion rates when running its 
algorithm over the rounds. It only knows the number of successes 
(subscriptions) and failures (no subscriptions) that have been 
accumulated over the previous rounds. You can see that most clearly in 
the code.</p>
			<p class="normal">Lastly, please make sure to keep in mind that in a 
real-life situation we would have no idea of what these conversion rates
 might be. We only know them here for simulation purposes, so that we 
can check in the end that our AI has managed to figure out the best 
strategy—which in our simulation here is <em class="italics">Strategy 7</em>.</p>
			<p class="normal">The next question is: how exactly are we going to run that simulation?</p>
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_80" lang="en-GB"><a id="_idTextAnchor117"/>Running the simulation</h3>
			<p class="normal">First, let's recap the different <a id="_idIndexMarker145"/>components of the environment (state, action, and reward):</p>
			<ol>
				<li class="list" value="1">The state is simply a specific customer onto whom we deploy a strategy and show them the ad of that strategy.</li>
				<li class="list">The action is the strategy selected to be deployed on the customer.</li>
				<li class="list">The reward is 1 if the customer subscribes to the premium plan, and 0 otherwise.</li>
			</ol>
			<p class="normal">Then, let's say that this e-commerce business wants
 to run the experiment of figuring out the best strategy on 10,000 
customers. Why the choice of 10,000? Because statistically, this is a 
large enough <a id="_idIndexMarker146"/>sample size to represent the 
whole base of customers. So, how are we going to simulate the response 
of 10,000 customers, based on the conversion rates of the ads 
established before? We don't have a choice other than to take a 
spreadsheet like Excel, or Google Sheets, and simulate how the 10,000 
customers would respond to each of the 9 ads. Here's how we are going to
 do this; it's a pretty nice trick.</p>
			<p class="normal">We are going to create a matrix of 10,000 rows and 9
 columns. Each row will correspond to a specific customer, and each 
column will correspond to a specific strategy. To be clear, let's say 
that:</p>
			<p class="normal">Row 1 corresponds to <em class="italics">Customer 1</em>.</p>
			<p class="normal">Row 2 corresponds to <em class="italics">Customer 2</em>.</p>
			<p class="normal">…</p>
			<p class="normal">Row 10000 corresponds to <em class="italics">Customer 10000</em>.</p>
			<p class="normal">Column 1 corresponds to <em class="italics">Strategy 1</em>.</p>
			<p class="normal">Column 2 corresponds to <em class="italics">Strategy 2</em>.</p>
			<p class="normal">…</p>
			<p class="normal">Column 9 corresponds to <em class="italics">Strategy 9</em>.</p>
			<p class="normal">In the cells of this matrix, we'll place a reward 
of 1 or 0 depending on whether each of these 10,000 customers would 
respond positively (subscription) or negatively (no subscription) to 
each of the 9 strategies. Here's where the "pretty nice trick" comes 
into play. In order to simulate the response of these 10,000 customers 
to the 9 ads while considering the conversion rates of these ads, here 
is what we do:</p>
			<p class="normal">For each customer (row) and for each strategy 
(column), we draw a random number between 0 and 1. If this random number
 is lower than the conversion rate of the strategy, the reward is 1. If 
this random number is higher than the conversion rate of the strategy, 
the reward is 0. Why does that work? Because by doing so, we will always
 have a <em class="italics">p</em>% chance of getting a 1, where <em class="italics">p</em> is the conversion rate of the strategy deployed to that customer.</p>
			<p class="normal">For example, let's take <em class="italics">Strategy</em><em class="italics"><a id="_idIndexMarker147"/></em><em class="italics"> 4</em>,
 which has a conversion rate of 0.16. For each of the customers, we draw
 a random number between 0 and 1. That random number has a 16% chance of
 being between 0 and 0.16, and a (100 – 16) = 84% chance of being 
between 0.16 and 1. Therefore, since we get a 1 when our random number 
is between 0 and 0.16, and we get a 0 when our random number is between 
0.16 and 1, then that means we have a 16% chance of getting a 1, and an 
84% chance of getting a zero.</p>
			<p class="normal">That simulates exactly the fact that when <em class="italics">Strategy 4</em>
 is deployed on a customer, that same customer will have a 16% chance of
 subscribing to the premium plan; that exactly corresponds to getting a 1
 reward.</p>
			<p class="normal">I hope you like the trick. It's pretty classic, but
 it's used very often in AI; it's important for you to know about it. We
 apply that trick to each of the 10,000 x 9 pairs of (customer, 
strategy) and we get the following matrix (this image only shows the 
first 10 rows):</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_03.png" alt=""/></figure>
			<p class="packt_figref">Figure 3: Simulated matrix of rewards</p>
			<p class="normal">Let's go through the three first rows in detail:</p>
			<ol>
				<li class="list" value="1">The first customer (row of index <strong class="bold">0</strong>) would not subscribe to the premium plan after being approached by any strategy.</li>
				<li class="list">The second customer (row of index <strong class="bold">1</strong>) would subscribe to the premium plan after being approached by <em class="italics">Strategy 5</em> or <em class="italics">Strategy</em><em class="italics"> 7</em> only.</li>
				<li class="list">The third customer (row of index <strong class="bold">2</strong>) would not subscribe to the premium plan after being approached by any strategy.</li>
			</ol>
			<p class="normal">We can already see in this preview that<a id="_idIndexMarker148"/>
 our little trick works; the ads with the lowest conversion rates 
(Strategies 1, 6, and 9) have only 0 rewards for the 11 first customers,
 while the ads with the highest conversion rates (Strategies 4 and 7) 
have some 1 rewards already. Note that the indexes here in this Python 
table start at 0; it's always like that in Python, and unfortunately 
there is nothing we can do about it. Don't worry, though, you'll get 
used to it!</p>
			<p class="normal">If you're a code lover, the code that generated this simulation is presented a little further along in the chapter.</p>
			<p class="normal">Our next step is to take a step back and recap.</p>
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_81" lang="en-GB"><a id="_idTextAnchor118"/>Recap</h3>
			<p class="normal">We're ready to simulate the actions of<a id="_idIndexMarker149"/>
 Thompson Sampling on 10,000 customers successively being approached by 
one of the 9 strategies, thanks to the preceding matrix, which will 
exactly simulate the decision of the customer to subscribe or not to the
 premium plan.</p>
			<p class="normal">If the cell corresponding to a specific customer 
and a specific selected strategy has a 1, that simulates a conversion by
 the customer to the premium plan. If the cell has a 0, that simulates a
 rejection. Thompson Sampling will collect the feedback of whether or 
not each of these customers subscribes to the premium plan, one customer
 after the other. Then, thanks to its powerful algorithm, it will 
quickly figure out the strategy with the highest conversion rate.</p>
			<p class="normal">That strategy is the best one to be deployed on millions of customers, maximizing the company's income from this new revenue<a id="_idTextAnchor119"/> stream.</p>
			<h2 class="title" xml:lang="en-GB" id="sigil_toc_id_82" lang="en-GB"><a id="_idTextAnchor120"/>AI solution and intuition refresher</h2>
			<p class="normal">Before you enjoy seeing your<a id="_idIndexMarker150"/> AI in action, let's refresh our memories and adapt the whole Thompson Sampling AI model to<a id="_idIndexMarker151"/> this new problem.</p>
			<p class="normal">By the way, if you don't like this e-commerce 
business application, feel totally free to imagine yourself back into 
the casino, surrounded by nine slot machines having the same conversion 
rates as the ones given to our strategies. It's exactly the same 
scenario; the 9 strategies could very well be nine slot machines giving 
with the same conversion rates either a 1 reward (making you money) or a
 0 reward (taking your money). Your goal would be to figure out as <a id="_idIndexMarker152"/>quickly
 as possible which slot machine has the highest chance of giving you the
 jackpot! It's up to you. Feel free to either go for Vegas or the AI 
Street, but as far as this chapter is concerned, I'll stick with our 
e-commerce business.</p>
			<p class="normal">For starters, let's remind ourselves that <a id="_idIndexMarker153"/>each time we show an ad to a new customer, that's considered a new round, <em class="italics">n</em>,
 and we select one of our 9 strategies to attempt a conversion 
(subscription to the premium plan). The goal is to figure out the best 
strategy (associated with the ad with the highest conversion rate) in 
the lowest number of rounds. Here's how Thompson Sampling does that:</p>
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_83" lang="en-GB"><a id="_idTextAnchor121"/>AI solution</h3>
			<p class="normal">For each round <span class="mediaobject"><img src="../Images/B14110_06_001.png" alt=""/></span> over 10,000 rounds, repeat the<a id="_idIndexMarker154"/> following three steps:</p>
			<p class="normal"><strong class="bold">Step 1</strong>: For each strategy <span class="mediaobject"><img src="../Images/B14110_06_002.png" alt=""/></span>, take a random draw from the following distribution:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_003.png" style="height: 2.25em;" alt=""/></figure>
			<p class="normal">where:</p>
			<ol>
				<li class="list" value="1"><span class="mediaobject"><img src="../Images/B14110_06_004.png" alt=""/></span> is the number of times the strategy <span class="mediaobject"><img src="../Images/B14110_06_005.png" alt=""/></span> has received a 1 reward up to round <span class="mediaobject"><img src="../Images/B14110_06_006.png" alt=""/></span>.</li>
				<li class="list"><span class="mediaobject"><img src="../Images/B14110_06_007.png" alt=""/></span> is the number of times the strategy <span class="mediaobject"><img src="../Images/B14110_06_008.png" alt=""/></span> has received a 0 reward up to round <span class="mediaobject"><img src="../Images/B14110_06_009.png" alt=""/></span>.</li>
			</ol>
			<p class="normal"><strong class="bold">Step 2</strong>: Select the strategy <span class="mediaobject"><img src="../Images/B14110_06_010.png" alt=""/></span> that has the highest <span class="mediaobject"><img src="../Images/B14110_06_011.png" alt=""/></span>:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_012.png" style="height: 2.5em;" alt=""/></figure>
			<p class="normal"><strong class="bold">Step </strong><strong class="bold">3</strong>: Update <span class="mediaobject"><img src="../Images/B14110_06_013.png" alt=""/></span> and <span class="mediaobject"><img src="../Images/B14110_06_014.png" alt=""/></span> according to the<a id="_idIndexMarker155"/> following conditions:</p>
			<ol>
				<li class="list" value="1">If the strategy selected <span class="mediaobject"><img src="../Images/B14110_06_015.png" alt=""/></span> received a 1 reward:
<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_0011.png" style="height: 2em;" alt=""/></figure></li>
				<li class="list">If the strategy selected <span class="mediaobject"><img src="../Images/B14110_06_017.png" alt=""/></span> received a 0 reward:
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_018.png" style="height: 2em;" alt=""/></figure>
</li>
</ol>
			<p class="normal">Now we've seen the mathematical steps, let's remind ourselves of the intuition behind them.</p>
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_84" lang="en-GB"><a id="_idTextAnchor122"/>Intuition</h3>
			<p class="normal">Each strategy has its own Beta distribution. Over 
the rounds, the Beta distribution of the strategy with the highest 
conversion rate<a id="_idIndexMarker156"/> will progressively be 
shifted to the right, and the Beta distributions of the strategies with 
lower conversion rates will be progressively shifted to the left (<em class="italics">Steps 1</em> and <em class="italics">3</em>). Therefore, in <em class="italics">Step 2</em>,
 the strategy with the highest conversion rate will be selected more and
 more often. Here is a graph displaying three Beta distributions of 
three strategies to help you visualize this:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_04.png" alt=""/></figure>
			<p class="packt_figref">Figure 4: Three Beta distributions</p>
			<p class="normal">You've taken a step back and you've had<a id="_idIndexMarker157"/>
 a refresher; I think you're ready for the implementation! In the next 
section, you'll put all that theory into practice—in other words, into 
code.</p>
			<h2 class="title" xml:lang="en-GB" id="sigil_toc_id_85" lang="en-GB">Im<a id="_idTextAnchor123"/>plementation</h2>
			<p class="normal">You'll develop the code as you work <a id="_idIndexMarker158"/>along
 this chapter, but keep in mind that I've provided the whole 
implementation of Thompson Sampling for this application; you have it 
available on the GitHub page (<a href="https://github.com/PacktPublishing/AI-Crash-Course"><span class="url">https://github.com/PacktPublishing/AI-Crash-Course</span></a>)
 of this book. If you want to try and run the code, you can do it on 
Colaboratory, Spyder in Anaconda, or simply your favorite IDE.</p>
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_86" lang="en-GB">T<a id="_idTextAnchor124"/>hompson Sampling vs. Random Selection</h3>
			<p class="normal">While implementing Thompson <a id="_idIndexMarker159"/>Sampling,
 you'll also implement the Random Selection algorithm, which will simply
 select a random strategy at each round. This will be<a id="_idIndexMarker160"/>
 your benchmark to evaluate the performance of your Thompson Sampling 
model. Of course, Thompson Sampling and the Random Selection algorithm 
will be competing on the same simulation, that is, on the same 
environment matrix.<a id="_idTextAnchor125"/></p>
			<h4 class="title" xml:lang="en-GB" id="sigil_toc_id_87" lang="en-GB"><a id="_idTextAnchor126"/>Performance measure</h4>
			<p class="normal">In the end, after the whole simulation is done, you <a id="_idIndexMarker161"/>can assess the performance of Thompson Sampling by computing the relative return, defined by the following formula:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_019.png" style="height: 3em;" alt=""/></figure>
			<p class="normal">You'll also have the chance to plot the histogram 
of selected ads, just to check that the strategy with the highest 
conversion rate (<em class="italics">Strategy 7</em>) was the one selected the most.</p>
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_88" lang="en-GB"><a id="_idTextAnchor127"/>Let's start coding</h3>
			<p class="normal">First, import the three following required<a id="_idIndexMarker162"/> libraries:</p>
			<ol>
				<li class="list" value="1"><code class="Code-In-Text--PACKT-">numpy</code>, which you will use to build the environment matrix.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">matplotlib.pyplot</code>, which you will use to plot the histogram.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">random</code>, which you will use to generate the random numbers needed for the simulation.</li>
			</ol>
			<p class="normal">Here is the extracted code from GitHub:</p>
			<pre class="programlisting language-markup"><code class="hljs capnproto"><span class="hljs-comment"># AI for Sales &amp; Advertizing - Sell like the Wolf of AI Street</span>
<span class="hljs-comment"># Importing the libraries</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> random
</code></pre>
			
			
			
			
			<p class="normal">Then set the parameters for the number of customers and strategies:</p>
			<ol>
				<li class="list" value="1"><code class="Code-In-Text--PACKT-">N</code> = 10,000 customers.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">d</code> = 9 strategies.</li>
			</ol>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs ini"><span class="hljs-comment"># Setting the parameters</span>
<span class="hljs-attr">N</span> = <span class="hljs-number">10000</span>
<span class="hljs-attr">d</span> = <span class="hljs-number">9</span>
</code></pre>
			
			
			<p class="normal">Then, create the simulation by building the 
environment matrix of 10,000 rows corresponding to the customers and 9 
columns corresponding to the strategies. At each round, and for each 
strategy, you draw a random number between 0 and 1. If this random 
number is lower than the conversion rate of the strategy, the reward 
will be 1. Otherwise, it will be 0. The environment matrix is named <code class="Code-In-Text--PACKT-">X</code> in the code.</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs angelscript"># Building the environment inside a simulation
conversion_rates = [<span class="hljs-number">0.05</span>,<span class="hljs-number">0.13</span>,<span class="hljs-number">0.09</span>,<span class="hljs-number">0.16</span>,<span class="hljs-number">0.11</span>,<span class="hljs-number">0.04</span>,<span class="hljs-number">0.20</span>,<span class="hljs-number">0.08</span>,<span class="hljs-number">0.01</span>]
X = np.<span class="hljs-built_in">array</span>(np.zeros([N,d]))
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(N):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(d):
        <span class="hljs-keyword">if</span> np.random.rand() &lt;= conversion_rates[j]:
            X[i,j] = <span class="hljs-number">1</span>
</code></pre>
			
			
			
			
			
			
			<p class="normal">Now that the environment is ready, you<a id="_idIndexMarker163"/>
 can start implementing the AI. To do so, the first step is to introduce
 and initialize the variables you will need for the implementation:</p>
			<ol>
				<li class="list" value="1"><code class="Code-In-Text--PACKT-">strategies_selected_rs</code>:
 A list that will contain the strategies selected over the rounds by the
 Random Selection algorithm. Initialize it as an empty list.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">strategies_selected_ts</code>:
 A list that will contain the strategies selected over the rounds by the
 Thompson Sampling AI model. Initialize it as an empty list.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">total_rewards_rs</code>: The total reward accumulated over the rounds by the Random Selection algorithm. Initialize it as 0.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">total_rewards_ts</code>: The total reward accumulated over the rounds by the Thompson Sampling AI model. Initialize it as 0.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">number_of_rewards_1</code>:
 A list of 9 elements which will contain for each strategy the number of
 times it received a 1 reward. Initialize it as a list of 9 zeros.</li>
				<li class="list"><code class="Code-In-Text--PACKT-">number_of_rewards_0</code>:
 A list of 9 elements which will contain for each strategy the number of
 times it received a 0 reward. Initialize it as a list of 9 zeros.</li>
			</ol>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs ini"><span class="hljs-comment"># Implementing Random Selection and Thompson Sampling</span>
<span class="hljs-attr">strategies_selected_rs</span> = []
<span class="hljs-attr">strategies_selected_ts</span> = []
<span class="hljs-attr">total_reward_rs</span> = <span class="hljs-number">0</span>
<span class="hljs-attr">total_reward_ts</span> = <span class="hljs-number">0</span>
<span class="hljs-attr">numbers_of_rewards_1</span> = [<span class="hljs-number">0</span>] * d
<span class="hljs-attr">numbers_of_rewards_0</span> = [<span class="hljs-number">0</span>] * d
</code></pre>
			
			
			
			
			
			
			<p class="normal">Then you need to begin the <code class="Code-In-Text--PACKT-">for</code>
 loop that will iterate the 10,000 rows (that is, the customers) of this
 environment matrix. At each round you'll get two separate selections of
 the deployed strategy; one from the Random<a id="_idIndexMarker164"/> Selection algorithm, and one from Thompson Sampling.</p>
			<p class="normal">Let's start with the Random Selection algorithm, which simply selects a random strategy in each round.</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs properties"><span class="hljs-attr">for</span> <span class="hljs-string">n in range(0, N):</span>
<span class="hljs-comment">    # Random Selection</span>
    <span class="hljs-attr">strategy_rs</span> = <span class="hljs-string">random.randrange(d)</span>
    <span class="hljs-attr">strategies_selected_rs.append(strategy_rs)</span>
    <span class="hljs-attr">reward_rs</span> = <span class="hljs-string">X[n, strategy_rs]</span>
    <span class="hljs-attr">total_reward_rs</span> = <span class="hljs-string">total_reward_rs + reward_rs</span>
</code></pre>
			
			
			
			
			
			<p class="normal">Next, you need to implement Thompson Sampling following exactly <em class="italics">Steps 1</em>, <em class="italics">2</em>, and <em class="italics">3</em>
 provided previously. I recommend looking at these steps again before 
coding the next part, and try to code by yourself before seeing my 
solution. That's the best way you can progress; practice makes perfect. 
You have all the elements required to code this; you even have similar 
code in <em class="italics">Chapter 5</em>, <em class="italics">Your First AI Model – Beware the Bandits!</em>. Good luck! Here is the solution.</p>
			<p class="normal">You should implement Thompson Sampling step by step, starting with the first step. Let's remind ourselves of it:</p>
			<p class="normal"><strong class="bold">Step 1</strong>: For each strategy <span class="mediaobject"><img src="../Images/B14110_06_020.png" alt=""/></span>, take a random draw from the following distribution:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_021.png" style="height: 2em;" alt=""/></figure>
			<p class="normal">where:</p>
			<ol>
				<li class="list" value="1"><span class="mediaobject"><img src="../Images/B14110_06_022.png" alt=""/></span> is the number of times the strategy <span class="mediaobject"><img src="../Images/B14110_06_023.png" alt=""/></span> has received a 1 reward up to round <span class="mediaobject"><img src="../Images/B14110_05_069.png" alt=""/></span></li>
				<li class="list"><span class="mediaobject"><img src="../Images/B14110_06_025.png" alt=""/></span> is the number of times the strategy <span class="mediaobject"><img src="../Images/B14110_06_026.png" alt=""/></span> has received a 0 reward up to round <span class="mediaobject"><img src="../Images/B14110_06_027.png" alt=""/></span></li>
			</ol>
			<p class="normal">Let's see how <em class="italics">Step 1</em> is implemented.</p>
			<p class="normal">Code a second <code class="Code-In-Text--PACKT-">for</code> loop that iterates the <a id="_idIndexMarker165"/>9 strategies, because you have to take a random draw from the Beta distribution of each of the 9 strategies.</p>
			<p class="normal">The random draws from the Beta distributions are generated by the <code class="Code-In-Text--PACKT-">betavariate()</code> function taken from the <code class="Code-In-Text--PACKT-">random</code> library, which you imported at the beginning.</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs angelscript">    # Thompson Sampling
    strategy_ts = <span class="hljs-number">0</span>
    max_random = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, d):
        random_beta = random.betavariate(numbers_of_rewards_1[i] + <span class="hljs-number">1</span>, numbers_of_rewards_0[i] + <span class="hljs-number">1</span>)
</code></pre>
			
			
			
			
			<p class="normal">Now implement <em class="italics">Step 2</em>, that is:</p>
			<p class="normal"><strong class="bold">Step 2</strong>: Select the strategy <span class="mediaobject"><img src="../Images/B14110_06_028.png" alt=""/></span> that has the highest <span class="mediaobject"><img src="../Images/B14110_06_029.png" alt=""/></span>:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_030.png" style="height: 2.5em;" alt=""/></figure>
			<p class="normal">To implement <em class="italics">Step 2</em>, you stay in the second <code class="Code-In-Text--PACKT-">for</code> loop which iterates the 9 strategies, and use a simple trick with an <code class="Code-In-Text--PACKT-">if</code> condition that will figure out the highest <span class="mediaobject"><img src="../Images/B14110_06_031.png" alt=""/></span>.</p>
			<p class="normal">The trick is the following: while iterating the strategies, if you find a random draw (<code class="Code-In-Text--PACKT-">random_beta</code>) that is higher than the maximum of the random draws obtained so far (<code class="Code-In-Text--PACKT-">max_random</code>), then that maximum becomes equal to that higher random draw.</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs properties"><span class="hljs-comment">    # Thompson Sampling</span>
    <span class="hljs-attr">strategy_ts</span> = <span class="hljs-string">0</span>
    <span class="hljs-attr">max_random</span> = <span class="hljs-string">0</span>
    <span class="hljs-attr">for</span> <span class="hljs-string">i in range(0, d):</span>
        <span class="hljs-attr">random_beta</span> = <span class="hljs-string">random.betavariate(numbers_of_rewards_1[i] + 1, numbers_of_rewards_0[i] + 1)</span>
        <span class="hljs-attr">if</span> <span class="hljs-string">random_beta &gt; max_random:</span>
            <span class="hljs-attr">max_random</span> = <span class="hljs-string">random_beta</span>
            <span class="hljs-attr">strategy_ts</span> = <span class="hljs-string">i</span>
    <span class="hljs-attr">reward_ts</span> = <span class="hljs-string">X[n, strategy_ts]</span>
</code></pre>
			
			
			
			
			
			
			
			
			<p class="normal">And finally, let's implement <em class="italics">Step 3</em>, the easiest one:</p>
			<p class="normal"><strong class="bold">Step 3</strong>: Update <img src="../Images/B14110_06_032.png" alt=""/> and <img src="../Images/B14110_06_033.png" alt=""/> according to the<a id="_idIndexMarker166"/> following conditions:</p>
			<ol>
				<li class="list" value="1">If the strategy selected <img src="../Images/B14110_06_034.png" alt=""/> received a 1 reward:
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_035.png" style="height: 1.75em;" alt=""/></figure>
</li>
				<li class="list">If the strategy selected <img src="../Images/B14110_06_036.png" alt=""/> received a 0 reward:
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_037.png" style="height: 1.75em;" alt=""/></figure>
</li>
</ol>
			<p class="normal">Implement that simply with the exact same two <code class="Code-In-Text--PACKT-">if</code> conditions, translated into code.</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs properties"><span class="hljs-comment">    # Thompson Sampling</span>
    <span class="hljs-attr">strategy_ts</span> = <span class="hljs-string">0</span>
    <span class="hljs-attr">max_random</span> = <span class="hljs-string">0</span>
    <span class="hljs-attr">for</span> <span class="hljs-string">i in range(0, d):</span>
        <span class="hljs-attr">random_beta</span> = <span class="hljs-string">random.betavariate(numbers_of_rewards_1[i] + 1, numbers_of_rewards_0[i] + 1)</span>
        <span class="hljs-attr">if</span> <span class="hljs-string">random_beta &gt; max_random:</span>
            <span class="hljs-attr">max_random</span> = <span class="hljs-string">random_beta</span>
            <span class="hljs-attr">strategy_ts</span> = <span class="hljs-string">i</span>
    <span class="hljs-attr">reward_ts</span> = <span class="hljs-string">X[n, strategy_ts]</span>
    <span class="hljs-attr">if</span> <span class="hljs-string">reward_ts == 1:</span>
        <span class="hljs-meta">numbers_of_rewards_1[strategy_ts]</span> = <span class="hljs-string">numbers_of_rewards_1[strategy_ts] + 1</span>
    <span class="hljs-attr">else</span>:<span class="hljs-string"/>
        <span class="hljs-meta">numbers_of_rewards_0[strategy_ts]</span> = <span class="hljs-string">numbers_of_rewards_0[strategy_ts] + 1</span>
</code></pre>
			
			
			
			
			
			
			
			
			
			
			
			
			<p class="normal">Next, don't forget to add the <a id="_idIndexMarker167"/>strategy selected in <em class="italics">Step 2</em> to our list of strategies (<code class="Code-In-Text--PACKT-">strategies_selected_ts</code>), and also to compute the total reward accumulated over the rounds by Thompson Sampling (<code class="Code-In-Text--PACKT-">total_reward_ts</code>).</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs properties"><span class="hljs-comment">    # Thompson Sampling</span>
    <span class="hljs-attr">strategy_ts</span> = <span class="hljs-string">0</span>
    <span class="hljs-attr">max_random</span> = <span class="hljs-string">0</span>
    <span class="hljs-attr">for</span> <span class="hljs-string">i in range(0, d):</span>
        <span class="hljs-attr">random_beta</span> = <span class="hljs-string">random.betavariate(numbers_of_rewards_1[i] + 1, numbers_of_rewards_0[i] + 1)</span>
        <span class="hljs-attr">if</span> <span class="hljs-string">random_beta &gt; max_random:</span>
            <span class="hljs-attr">max_random</span> = <span class="hljs-string">random_beta</span>
            <span class="hljs-attr">strategy_ts</span> = <span class="hljs-string">i</span>
    <span class="hljs-attr">reward_ts</span> = <span class="hljs-string">X[n, strategy_ts]</span>
    <span class="hljs-attr">if</span> <span class="hljs-string">reward_ts == 1:</span>
        <span class="hljs-meta">numbers_of_rewards_1[strategy_ts]</span> = <span class="hljs-string">numbers_of_rewards_1[strategy_ts] + 1</span>
    <span class="hljs-attr">else</span>:<span class="hljs-string"/>
        <span class="hljs-meta">numbers_of_rewards_0[strategy_ts]</span> = <span class="hljs-string">numbers_of_rewards_0[strategy_ts] + 1</span>
    <span class="hljs-attr">strategies_selected_ts.append(strategy_ts)</span>
    <span class="hljs-attr">total_reward_ts</span> = <span class="hljs-string">total_reward_ts + reward_ts</span>
</code></pre>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<p class="normal">Then compute the final score, which is the relative
 return of Thompson Sampling with respect to our benchmark, which is 
Random Selection:</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs lisp"># Computing the Relative Return
relative_return = (<span class="hljs-name">total_reward_ts</span> - total_reward_rs) / total_reward_rs * <span class="hljs-number">100</span>
print(<span class="hljs-string">"Relative Return: {:.0f} %"</span>.format(<span class="hljs-name">relative_return</span>))
</code></pre>
			
			
			<h3 class="title" xml:lang="en-GB" id="sigil_toc_id_89" lang="en-GB">The final r<a id="_idTextAnchor128"/>esult</h3>
			<p class="normal">By executing this code, I obtained a final relative<a id="_idIndexMarker168"/> return of 91%. In other words, Thompson Sampling almost doubled the performance of my Random Selection benchmark. Not too bad!</p>
			<p class="normal">Finally, plot a histogram of the selected strategies to check that <em class="italics">Strategy 7</em> (at index 6) was the one most selected, since it is the one with the highest conversion rate. To do this, use the <code class="Code-In-Text--PACKT-">hist()</code> function from the <code class="Code-In-Text--PACKT-">matplotlib</code> library.</p>
			<p class="normal"><strong class="bold">Code</strong>:</p>
			<pre class="programlisting language-markup"><code class="hljs less"># <span class="hljs-selector-tag">Plotting</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">Histogram</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">Selections</span>
<span class="hljs-selector-tag">plt</span><span class="hljs-selector-class">.hist</span>(strategies_selected_ts)
<span class="hljs-selector-tag">plt</span><span class="hljs-selector-class">.title</span>(<span class="hljs-string">'Histogram of Selections'</span>)
<span class="hljs-selector-tag">plt</span><span class="hljs-selector-class">.xlabel</span>(<span class="hljs-string">'Strategy'</span>)
<span class="hljs-selector-tag">plt</span><span class="hljs-selector-class">.ylabel</span>(<span class="hljs-string">'Number of times the strategy was selected'</span>)
<span class="hljs-selector-tag">plt</span><span class="hljs-selector-class">.show</span>()
</code></pre>
			
			
			
			
			
			<p class="normal">This is the most exciting time—the code is complete
 (congrats by the way), and you can enjoy the results. Having the final 
relative return is nice, but finishing with a clean visualization plot 
is even better. And that's what you get by executing the final code:</p>
			<figure class="mediaobject" xml:lang="en-GB" lang="en-GB"><img src="../Images/B14110_06_05.png" alt=""/></figure>
			<p class="packt_figref">Figure 5: Histogram of Selections</p>
			<p class="normal">You can see that the strategy at index <strong class="bold">6</strong>, <em class="italics">Strategy 7</em>,
 was by far selected the most. Thompson Sampling was quickly able to 
identify it as the best strategy. In fact, if you re-run the same code 
but with only 1,000 customers, you'll see that Thompson Sampling is 
still able to identify <em class="italics">Strategy 7</em> as the best one.</p>
			<p class="normal">Thompson Sampling did an<a id="_idIndexMarker169"/>
 amazing job for this e-commerce business. Not only was it able to 
identify the best strategy in a small number of rounds—that means fewer 
customers, which saves on advertising and operating costs—but also it 
was able to clearly figure out the strategy with the highest conversion 
rate.</p>
			<p class="normal">If this e-commerce business has, for example, 50 
million customers, and if the premium plan has a price of $200 per year,
 then deploying this best strategy with a conversion rate of 20 % would 
lead to generate an extra revenue of 50,000,000 × 0.2 × $200 = $2 
billion!</p>
			<p class="normal">In other words, Thompson Sampling clearly and 
quickly smashed the sales and advertising for this e-commerce business, 
so much so that we really can call it the wolf of AI Street.</p>
			<p class="normal">Now, take a break, you deserve it. Get refreshed, 
and as soon as you are recharged and all set for a new AI adventure, 
I'll be here ready as well to start the next chapter. See you back soon!</p>
			<h2 class="title" xml:lang="en-GB" id="sigil_toc_id_90" lang="en-GB"><a id="_idTextAnchor129"/>Summary</h2>
			<p class="normal">In this fi<a id="_idTextAnchor130"/>rst 
practical tutorial, you implemented Thompson Sampling to solve the 
multi-armed bandit problem as applied to an advertising campaign. 
Thompson Sampling was able to find the best business strategy quickly, 
something which Random Selection was unable to do. In total you 
generated 91% of relative return, which, after making some assumptions, 
would generate an extra 2 billion dollars in revenue. You did that in 
just one file in less than 60 lines of code. Quite astounding, right?</p>
</body></html>